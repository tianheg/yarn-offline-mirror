# yarn offline mirror

## How to Use

下面我们开始为 yarn 设置离线安装环境，这才是 yarn 最精彩的地方。

为了能有一个地方存储 yarn 下载下来的安装包，我们需要设置一个与项目和机器彻底无关的文件夹，假定我们就在电脑的根目录下存储这些文件，我们首先建立一个文件夹，允许别人访问它：

```shell
sudo mkdir /Projects
sudo chmod 777 /Projects
```

然后，我们告诉 `yarn` 到这里来存储和读取离线安装包：

```shell
yarn config set yarn-offline-mirror /Projects/yarn-offline-mirror
```

这时候，`yarn` 会在你当前用户的根目录下生成一个 `.yarnrc` 的文件，你可以把这个文件搬到你项目的根目录下：

```shell
mv ~/.yarnrc ./
```

这个文件的内容很短，打开来看一下：

```yarnrc
## THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.
## yarn lockfile v1


lastUpdateCheck 1520049128107
yarn-offline-mirror "/Projects/yarn-offline-mirror"
```

它的大意是说这是一个自动生成的文件，你不应该直接修改文件内容（不过其实如果你知道你在干的是什么的，修改也是没有关系的，毕竟不是二进制文件）。这里面就列出了我们离线包的存储位置。

接下来我们开始往我们的离线文件夹灌入内容。我们先把我们当前项目的 `node_modules` 文件夹和 `yarn.lock` 文件删除：

```shell
rm -rf node_modules/ yarn.lock
```

然后，我们执行一下

```shell
yarn install
```

这时候你会看到 `yarn` 不但重新生成了 `node_modules` 文件夹和 `yarn.lock` 文件，并且把下载下来的安装包全都放入了我们刚才设定好的离线安装路径 `/Projects/yarn-offline-mirror`。

## 验证

我们怎么验证 `yarn` 确实可以离线安装呢？我们还是先把 `node_modules` 文件夹删掉，注意，这次不要再删 `yarn.lock` 文件了：

```shell
rm -rf node_modules
```

为了彻底起见，我们把 yarn 的缓存也删掉：

```shell
yarn cache clean
```

然后，我们把 `wifi` 关掉，把网线拔掉，然后我们再执行：

```shell
yarn install -offline
```

成功了！在没有任何网络的情况下，我们继续可以重建 `node_modules` 文件夹，它取的就是我们刚才设定好的 `/Projects/yarn-offline-mirror` 里的内容。

## Reference

- [为什么你应该用Yarn而不是Npm来管理你的项目依赖？](https://www.fengerzh.com/yarn-offline/)
- [Running Yarn offline](https://classic.yarnpkg.com/blog/2016/11/24/offline-mirror/)
